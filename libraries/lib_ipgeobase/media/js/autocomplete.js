/*! boc.autocomplete 2015-03-26 */
!function(){"use strict";var a={RETURN:13,TAB:9,DOWN:40,UP:38},b=window.Autocomplete=function(a,c){var d=document.createElement("ul");d.className="autocomplete",this.ul=d,this.jsonHttp=new window.JsonHttp,this.options={url:c.url+"&"+c.param+"=",label:c.label,el:c.el,input:c.input,select:c.select},a.autocomplete="off",a.className="autocomplete",a.addEventListener("input",this.inputEvt.bind(this)),a.addEventListener("keydown",this.keyEvt.bind(this)),this.input=a,b.insertAfter(this.ul,this.input)};b.prototype={select:function(a,c){a.input.value=c.innerHTML,a.options.select&&a.options.select(JSON.parse(c.dataset.item)),b.clear(a.ul)},inputEvt:function(){if(""===this.input.value)return void b.clear(this.ul);var a=this,c=a.options.url+encodeURIComponent(a.input.value);a.jsonHttp.get(c,function(c,d){b.clear(a.ul),c?(a.input.placeholder="ошибка получения данных...",a.input.value=""):d.forEach(function(b){var c=document.createElement("li");c.appendChild(document.createTextNode(b[a.options.label])),c.setAttribute("data-item",JSON.stringify(b)),c.addEventListener("click",function(){a.select(a,this)}),a.ul.appendChild(c)})})},keyEvt:function(c){var d;c.keyCode===a.DOWN?b.keyDown(this.ul):c.keyCode===a.UP?b.keyUp(this.ul):c.keyCode===a.TAB&&this.ul.firstChild?(d=this.ul.querySelector(".selected"),c.preventDefault(),d?this.select(this,d):this.select(this,this.ul.firstChild)):c.keyCode===a.RETURN&&this.ul.firstChild&&(d=this.ul.querySelector(".selected"),c.preventDefault(),d&&this.select(this,d))}},b.keyUp=function(a){var c=a.querySelector(".selected");c&&(c.previousSibling?(c.className="",c=c.previousSibling,c.className=b.CSS):(c.className="",c=null))},b.keyDown=function(a){var c=a.querySelector(".selected");c?c.nextSibling&&(c.className="",c=c.nextSibling,c.className=b.CSS):(c=a.firstChild,c.className=b.CSS)},b.CSS="selected",b.insertAfter=function(a,b){b.parentNode.insertBefore(a,b.nextSibling)},b.clear=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)}}(window),function(){"use strict";var a=window.JsonHttp=function(){this.xhr=new XMLHttpRequest};a.prototype={get:function(a,b){var c=this.xhr;c.onreadystatechange=function(){4===this.readyState&&(200===this.status?b(null,this.response):b("error"))},c.open("GET",a),c.responseType="json",c.send()}}}();